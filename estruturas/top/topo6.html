{% set paginasTopo = store.getDynamicPages({text_upper:true}) %}
{% set categorias = store.categories() %}
{% set categorias_menu = store.categoriesMenu({menu:'all'}) %}
{% set whatsapp = store.getWhatsappAttendance() %}
{% set ofertasPeriodicas = store.periodicOffers() %}

<header class="block">
    {% if ofertasPeriodicas[0].id %}
        <component data-modulo="ofertasperiodicas" loading="false" data-paddingtop="false" data-hidescroll="false"></component>
    {% endif %}
    <div class="header">
        <div class="d-flex flex-row align-items-center">
            <div class="openmenu-mobile hamburger-icon d-md-none">
                <span class="hamburger"></span>
            </div>
            <div class="busca_btn_mobile d-flex d-md-none">
                <svg class="svg-icon" viewBox="0 0 20 20">
                    <path fill="none" d="M12.323,2.398c-0.741-0.312-1.523-0.472-2.319-0.472c-2.394,0-4.544,1.423-5.476,3.625C3.907,7.013,3.896,8.629,4.49,10.102c0.528,1.304,1.494,2.333,2.72,2.99L5.467,17.33c-0.113,0.273,0.018,0.59,0.292,0.703c0.068,0.027,0.137,0.041,0.206,0.041c0.211,0,0.412-0.127,0.498-0.334l1.74-4.23c0.583,0.186,1.18,0.309,1.795,0.309c2.394,0,4.544-1.424,5.478-3.629C16.755,7.173,15.342,3.68,12.323,2.398z M14.488,9.77c-0.769,1.807-2.529,2.975-4.49,2.975c-0.651,0-1.291-0.131-1.897-0.387c-0.002-0.004-0.002-0.004-0.002-0.004c-0.003,0-0.003,0-0.003,0s0,0,0,0c-1.195-0.508-2.121-1.452-2.607-2.656c-0.489-1.205-0.477-2.53,0.03-3.727c0.764-1.805,2.525-2.969,4.487-2.969c0.651,0,1.292,0.129,1.898,0.386C14.374,4.438,15.533,7.3,14.488,9.77z"></path>
                </svg>
            </div>
            {% if not is_mobile %}
                <h1 class="d-none d-md-block">
                    <a href="./" class="btLogo" style="background-image:url('{{ store.getLogo() }}');" aria-label="{{ seo.title }}">
                        {{ seo.title }}
                    </a>
                </h1>
            {% endif %}
        </div>
        {% if is_mobile %}
            <h1 class="Logo_mobile">
                <a href="./" class="btLogo_mobile" style="background-image:url('{{ store.getLogo() }}');" aria-label="{{ seo.title }}">
                    {{ seo.title }}
                </a>
            </h1>
        {% endif %}
        <div class="hamburger-scroll__container">
            <div class="hamburger-scroll">
                <span class="hamburger_item"></span>
                <span class="hamburger_item"></span>
                <span class="hamburger_item"></span>
            </div>
            <div class="hamburger-scroll__label">
                Abrir/Fechar Departamentos
            </div>
        </div>
        {% if not global.var_mostruario or (global.var_mostruario and not global.var_bloquear_cadastros) %}
            <div class="conta" id="login_btn">
                <div class="login_btn" >
                    <svg class="svg-icon" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/>
                    </svg>
                </div>
                <div class="login__label load-action-login"></div>
            </div>
        {% endif %}
        <div class="search_desktop d-none d-md-block search" id="searchDesktop">
            <form action="busca/" method="get">
                <input type="text" class="form-control" name="q" aria-label="Buscar" data-url="produtos_autocomplete.php" placeholder="Buscar">
                <button type="submit" class="busca_btn" aria-label="Pesquisar">
                    <svg class="svg-icon" viewBox="0 0 20 20">
                        <path fill="none" d="M12.323,2.398c-0.741-0.312-1.523-0.472-2.319-0.472c-2.394,0-4.544,1.423-5.476,3.625C3.907,7.013,3.896,8.629,4.49,10.102c0.528,1.304,1.494,2.333,2.72,2.99L5.467,17.33c-0.113,0.273,0.018,0.59,0.292,0.703c0.068,0.027,0.137,0.041,0.206,0.041c0.211,0,0.412-0.127,0.498-0.334l1.74-4.23c0.583,0.186,1.18,0.309,1.795,0.309c2.394,0,4.544-1.424,5.478-3.629C16.755,7.173,15.342,3.68,12.323,2.398z M14.488,9.77c-0.769,1.807-2.529,2.975-4.49,2.975c-0.651,0-1.291-0.131-1.897-0.387c-0.002-0.004-0.002-0.004-0.002-0.004c-0.003,0-0.003,0-0.003,0s0,0,0,0c-1.195-0.508-2.121-1.452-2.607-2.656c-0.489-1.205-0.477-2.53,0.03-3.727c0.764-1.805,2.525-2.969,4.487-2.969c0.651,0,1.292,0.129,1.898,0.386C14.374,4.438,15.533,7.3,14.488,9.77z"></path>
                    </svg>
                </button>
            </form>
        </div>
        <div class="d-flex flex-row align-items-center justify-content-between ml-2">
            {% if whatsapp.online %}
                <div class="wpp_link mr-4">
                    <div class="brand_logo">
                        <i class="fa fa-whatsapp"></i>
                    </div>
                    <div class="wpp_lable">
                        <span class="call">WhatsApp SAC</span>
                        <span class="wpp_tell"><a href="{{ whatsapp.url }}" target="_blank">{{ whatsapp.numero_raw }}</a></span>
                    </div>
                </div>
            {% endif %}
            {% if not global.var_mostruario %}
                <div class="cart_container shopcart{{ global.var_carrinho_suspenso ? ' suspended' : '' }}" id="cartBtn">
                    <a href="carrinho/" class="d-inline-flex">
                        <div class="cart">
                            <svg  class="svg-icon" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" d="M8 1a2 2 0 0 0-2 2v4.5a.5.5 0 0 1-1 0V3a3 3 0 0 1 6 0v4.5a.5.5 0 0 1-1 0V3a2 2 0 0 0-2-2z"/>
                                <path fill-rule="evenodd" d="M3.405 6a.5.5 0 0 0-.498.45l-.912 6.9A1.5 1.5 0 0 0 3.488 15h9.024a1.5 1.5 0 0 0 1.493-1.65l-.913-6.9a.5.5 0 0 0-.497-.45h-9.19zm-1.493.35A1.5 1.5 0 0 1 3.405 5h9.19a1.5 1.5 0 0 1 1.493 1.35L15 13.252A2.5 2.5 0 0 1 12.512 16H3.488A2.5 2.5 0 0 1 1 13.251l.912-6.9z"/>
                            </svg>
                            <span class="sup">0</span>
                        </div>
                        <div class="cart-total cart__label">
                            <span class="text__lable">minhas compras</span>
                            <span class="cart-total-label total__lable cart-amount">R$0,00</span>
                        </div>
                    </a>
                </div>
            {% endif %}
        </div>
    </div>
    {% if show_menu != false or page != 'principal.php' %}
        <div class="links d-none d-md-block">
            <div class="central">
                <ul class="categorias_desk">
                    {% for cat in categorias_menu|filter(cat => cat.menu == '1')|slice(0,15) %}
                    <li>
                        <a class="links_item" href="{{ cat.url }}" target="{{ cat.target }}">
                            {{ cat.icone_categoria|raw }}
                            <span {% if cat.cor != '' %} style="color:{{ cat.cor }}" {% endif %}>{{ cat.nome }}</span>
                        </a>
                        {% if cat.subs|length >= 1 %}
                        <div class="dropdown">
                            <ul class="list_l2">
                                {% for level2 in cat.subs %}
                                <li class="l2_item">
                                    <a href="{{ level2.url }}" target="{{ level2.target }}">
                                        <span>
                                            {{ level2.icone_categoria|raw }}
                                            {{ level2.nome }}
                                        </span>
                                        {% if level2.subs|length >= 1 %}
                                        <i class="fa fa-angle-right"></i>
                                        {% endif %}
                                    </a>
                                    {% if level2.subs|length >= 1 %}
                                    <ul class="list_l3">
                                        {% for level3 in level2.subs %}
                                        <li class="l3_item"><a href="{{ level3.url }}" target="{{ level3.target }}">{{ level3.nome }}</a></li>
                                        {% endfor %}
                                    </ul>
                                    {% endif %}
                                </li>
                                {% endfor %}
                            </ul>
                            {% if cat.banner != ''%}
                            <div class="bnr">
                                {{ cat.banner|raw }}
                            </div>
                            {% endif %}
                        </div>
                        {% endif %}
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    {% endif %}
    
    <div id="mobile-menu-topo" class="mobileMenu">
        <div class="nav-menu mobileContainer">
            <nav class="mobileNav">
                {% if not global.var_mostruario or (global.var_mostruario and not global.var_bloquear_cadastros) %}
                    <li class="login_mobile load-action-login-mobile"></li>
                {% endif %}
                
                {% if kits_config.total >= 1 and kits_config.show_menu == '1' %}
                    <li><a class="navItem" href="{{ kits_config.url }}">{{ kits_config.names }}</a></li>
                {% endif %}
                
                {% for categoria in categorias_menu|filter(cat => cat.menu_mobile == '1') %}
                    <li>
                        <a class="navItem" href="{{ categoria.url }}" target="{{ categoria.target }}"{{ categoria.cor != '' ? (' style="color:' ~ categoria.cor ~ '"')|raw : '' }}>
                            {{ categoria.nome }}
                        </a>
                        {% if categoria.subs >= 1 %}
                            <div class="btDropdown">
                                <i class="fa fa-angle-right"></i>
                            </div>
                        {% endif %}
                        {% if categoria.subs >= 1 %}
                        <ul class="subCategoria level2">
                            <li class="lvlBack">
                                <div class="btDropdown">
                                    <i class="fa fa-angle-left"></i>
                                </div>
                            </li>
                            {% for level2 in categoria.subs %}
                                <li>
                                    <a class="navItem" href="{{ level2.url }}" target="{{ level2.target }}"{{ level2.cor != '' ? (' style="color:' ~ level2.cor ~ '"')|raw : '' }}>
                                        {{ level2.nome }}
                                    </a>
                                    {% if level2.subs >= 1 %}
                                        <div class="btDropdown">
                                            <i class="fa fa-angle-right"></i>
                                        </div>
                                    {% endif %}
                                    {% if level2.subs >= 1 %}
                                        <ul class="subCategoria level3">
                                            <li class="lvlBack">
                                                <div class="btDropdown">
                                                    <i class="fa fa-angle-left"></i>
                                                </div>
                                            </li>
                                            {% for level3 in level2.subs %}
                                                <li>
                                                    <a class="navItem font-weight-bold" href="{{ level3.url }}" target="{{ level3.target }}"{{ level3.cor != '' ? (' style="color:' ~ level3.cor ~ '"')|raw : '' }}>
                                                        {{ level3.nome }}
                                                    </a>
                                                </li>
                                            {% endfor %}
                                        </ul >
                                    {% endif %}
                                </li>
                            {% endfor %}
                        </ul>
                        {% endif %}
                    </li>
                {% endfor %}
            </nav>
        </div>
    </div>
    <div class="search" id="searchMobile">
        <form action="busca/" method="get">
            <input type="text" class="form-control" name="q" data-url="produtos_autocomplete.php" placeholder="Digite o que está procurando!">
            <button type="submit">
                <svg class="svg-icon" viewBox="0 0 20 20">
                    <path fill="none" d="M12.323,2.398c-0.741-0.312-1.523-0.472-2.319-0.472c-2.394,0-4.544,1.423-5.476,3.625C3.907,7.013,3.896,8.629,4.49,10.102c0.528,1.304,1.494,2.333,2.72,2.99L5.467,17.33c-0.113,0.273,0.018,0.59,0.292,0.703c0.068,0.027,0.137,0.041,0.206,0.041c0.211,0,0.412-0.127,0.498-0.334l1.74-4.23c0.583,0.186,1.18,0.309,1.795,0.309c2.394,0,4.544-1.424,5.478-3.629C16.755,7.173,15.342,3.68,12.323,2.398z M14.488,9.77c-0.769,1.807-2.529,2.975-4.49,2.975c-0.651,0-1.291-0.131-1.897-0.387c-0.002-0.004-0.002-0.004-0.002-0.004c-0.003,0-0.003,0-0.003,0s0,0,0,0c-1.195-0.508-2.121-1.452-2.607-2.656c-0.489-1.205-0.477-2.53,0.03-3.727c0.764-1.805,2.525-2.969,4.487-2.969c0.651,0,1.292,0.129,1.898,0.386C14.374,4.438,15.533,7.3,14.488,9.77z"></path>
                </svg>
            </button>
        </form>
    </div>
</header>

{% if global.var_carrinho_suspenso %}
<div class="suspended-cart">
    <div class="cover"></div>
    <div class="content"></div>
</div>
{% endif %}

<script>
$(function(){
    var hTopo = $('header').outerHeight(true);
    setTimeout(function(){
        hTopo = $('header').outerHeight(true);
    }, 500);

    $(window).scroll(function(){
        let scr = $(this).scrollTop();

        if(scr >= hTopo){
            if(!$('header').hasClass('scroll'))
                $('header').addClass('scroll');

            if($('header').hasClass('scroll'))
                $('#geral').css("padding-top", hTopo);
        }else{
            if($('header').hasClass('scroll'))
                $('header').removeClass('scroll');
            
            if(!$('header').hasClass('scroll'))
                $('#geral').css("padding-top", 0);
        }
    });

    // abre e fecha o menu
    $('.openmenu-mobile').click(function(e){
        e.preventDefault();
        $('#mobile-menu-topo').toggleClass('open');
        document.location.hash = '#menu';
        $('body').toggleClass('no-scroll noscroll');
    });
    $('header').on('click', '#mobile-menu-topo', function(e){
        if(!$(e.target).closest("#mobile-menu-topo .nav-menu, #obile-menu-topo .b-desconectar").length)
            window.history.back();
    });

    $(window).on('popstate', function(){
        let hash = document.location.hash;
        if(hash == ''){
            $('#mobile-menu-topo').removeClass('open');
        }
    });
    //

    // anima hamburger icon do menu
    $(".hamburger-icon").click(function () {
        $('#modalDesktop').toggleClass('active');
        $('.subCategoria').removeClass('slide');
        $('#searchMobile').removeClass('show');
        $('.busca_btn_mobile').removeClass('active')
        if($('body').hasClass('noscroll')){
            $('body').removeClass('noscroll');
        }else{
            $('body').addClass('noscroll');
        }
    });

    $("#modalDesktop").click(function () {
        $('body').removeClass('noscroll no-scroll');
        $(this).removeClass('active');
        $('.subCategoria').removeClass('slide');
    });

    $(".hamburger-scroll").click(function () {
        $('.hamburger-scroll').toggleClass('open');
        $('.links').toggleClass('open');
    });
    //

    $('.btDropdown').click(function(){
        $(this).parent('li').children('.subCategoria').toggleClass('slide');
    });

    $('.lvlBack').click(function(){
        $(this).parent('.subCategoria').toggleClass('slide');
    });

    $('.busca_btn_mobile').click(function(){
        $('#searchMobile').toggleClass('show');
        $('.busca_btn_mobile').toggleClass('active');
        $(".hamburger-icon").removeClass("active")
        $('.subCategoria').removeClass('slide');
        $('.mobileMenu').removeClass('open');
        $('#modalDesktop').removeClass('active')
    });

    $('.close_modal').click(function(){
        $('#modalDesktop').removeClass('active');
        $('#searchMobile').removeClass('active');
    });
    
    setTimeout(function(){
        $('.mobileMenu.hasOffer .mobileContainer').css({'padding-top':$('header').outerHeight(true)});
    }, 1500);

    $.post('action.php', {funcao:'userdata'}, function(d){
        let html = '';
        let html_mobile = '';
        if(d.logged !== '1'){
            let modal_login_title = '{{ global.textos_painel.modal_login_titulo ?: "Entrar" }}';
            
            html = '<h4 class="mb-1 login_head">Olá Visitante!</h4>';
            {% if global.var_login_suspenso %}
                html += '<a href="./" class="mymodal login_btn" data-include="inc.php?meio=modulos/login/inc_login" data-width="400" title="'+modal_login_title+'">Entrar/Cadastrar</a>';
            {% else %}
                html += '<a href="login/">Entrar/Cadastrar</a>';
            {% endif %}

            html_mobile = `<div class="login_ico">
                <svg class="svg-icon" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/>
                </svg>
            </div>
            <div class="login_group">
                <span class="mb-1 login_head">Olá <b>Visitante</b>!</span>
                <a href="./" class="mymodal login_btn mb-1" data-include="inc.php?meio=inc_login" data-width="300" title="${modal_login_title}">Faça seu <b>login</b></a>
            </div>`;
        }else{
            html = '<h4 class="login_head mb-1">Olá '+d.data.primeiro_nome+'!</h4>';
            html += '<div class="login_group"><a href="central/" class="login_btn">Minha Conta</a> | <a href="#" class="login_btn b-desconectar">Sair</a></div>';
            
            html_mobile = `<div class="login_ico" >
                <svg class="svg-icon" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/>
                </svg>
            </div>
            <div class="login_group">
                <span class="mb-1 login_head">Olá <b>${d.data.primeiro_nome}</b>!</span>
                <span class="btn_navLogin">
                <a href="central/" class="mb-1">Minha Conta </a> | <a href="#" id="b-desconectar"> Sair</a>
                </span>
            </div>`;
        }
        
        $('.load-action-login').html(html);
        $('.load-action-login-mobile').html(html_mobile);
    }, 'json');
});
</script>